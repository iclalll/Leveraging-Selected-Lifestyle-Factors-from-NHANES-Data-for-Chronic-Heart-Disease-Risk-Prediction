# -*- coding: utf-8 -*-
"""Leveraging Selected Lifestyle Factors from  NHANES Data for Chronic Heart Disease Risk  Prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ffDYuimSMZRc3OsISRNZ_3V7LkWtRkLz
"""

# ğŸ“¦ Gerekli KÃ¼tÃ¼phaneleri YÃ¼kle
!pip install -q kaggle

# ğŸ”‘ Kaggle API anahtarÄ±nÄ± Colab'a yÃ¼kle
import os
import json

kaggle_token = {
    "username": "KAGGLE_USERNAMEÄ°N",
    "key": "KAGGLE_KEYÄ°N"
}

# KullanÄ±cÄ± bilgilerini json dosyasÄ±na yaz
with open('/root/.kaggle/kaggle.json', 'w') as file:
    json.dump(kaggle_token, file)

os.chmod('/root/.kaggle/kaggle.json', 600)

# ğŸ“¥ Veri setini indir
!kaggle datasets download -d fedesoriano/heart-failure-prediction

# ğŸ—ƒï¸ ZIP dosyasÄ±nÄ± Ã§Ä±kar
!unzip -o heart-failure-prediction.zip

# ğŸ“ KlasÃ¶rÃ¼ oluÅŸtur
import os
import json

os.makedirs("/root/.kaggle", exist_ok=True)  # â† Bu satÄ±r klasÃ¶rÃ¼ oluÅŸturur

# ğŸ‘‡ BURAYA kendi kaggle.json iÃ§eriÄŸini yapÄ±ÅŸtÄ±r
kaggle_token = {
    "username": "senin_kaggle_username",
    "key": "senin_kaggle_key"
}

# ğŸ” JSON dosyasÄ±nÄ± yaz ve izinleri ayarla
with open('/root/.kaggle/kaggle.json', 'w') as file:
    json.dump(kaggle_token, file)

os.chmod('/root/.kaggle/kaggle.json', 600)



# ğŸ“¦ Gerekli KÃ¼tÃ¼phaneleri YÃ¼kle
!pip install -q kaggle

# ğŸ”‘ Kaggle API anahtarÄ±nÄ± Colab'a yÃ¼kle
import os
import json

kaggle_token = {
    "username": "KAGGLE_USERNAMEÄ°N",
    "key": "KAGGLE_KEYÄ°N"
}

# KullanÄ±cÄ± bilgilerini json dosyasÄ±na yaz
with open('/root/.kaggle/kaggle.json', 'w') as file:
    json.dump(kaggle_token, file)

os.chmod('/root/.kaggle/kaggle.json', 600)

# ğŸ“¥ Veri setini indir
!kaggle datasets download -d fedesoriano/heart-failure-prediction

# ğŸ—ƒï¸ ZIP dosyasÄ±nÄ± Ã§Ä±kar
!unzip -o heart-failure-prediction.zip

# 1. Gerekli klasÃ¶rÃ¼ oluÅŸtur
!mkdir -p ~/.kaggle

# 2. Kaggle json dosyasÄ±nÄ± yÃ¼kle
from google.colab import files
uploaded = files.upload()  # â† bilgisayarÄ±ndan `kaggle.json` dosyasÄ±nÄ± tekrar yÃ¼kle

# 3. DosyayÄ± doÄŸru yere taÅŸÄ± ve izinleri ayarla
!cp kaggle.json ~/.kaggle/
!chmod 600 ~/.kaggle/kaggle.json

# 4. Veri setini indir (Bu adÄ±m Ã¶nemli)
!kaggle datasets download -d fedesoriano/heart-failure-prediction

# 5. ZIP dosyasÄ±nÄ± Ã§Ä±kar
!unzip -o heart-failure-prediction.zip

import pandas as pd

# Veriyi yÃ¼kle
df = pd.read_csv("heart.csv")

# Ä°lk 5 satÄ±rÄ± gÃ¶ster
df.head()

from sklearn.preprocessing import LabelEncoder
import matplotlib.pyplot as plt
import seaborn as sns

# Kategorik deÄŸiÅŸkenleri etiketle
categorical_cols = ['Sex', 'ChestPainType', 'RestingECG', 'ExerciseAngina', 'ST_Slope']
df_encoded = df.copy()
le = LabelEncoder()

for col in categorical_cols:
    df_encoded[col] = le.fit_transform(df_encoded[col])

# Veri seti artÄ±k sayÄ±sal hale geldi
df_encoded.head()



sns.countplot(data=df_encoded, x="HeartDisease")
plt.title("Heart Disease SÄ±nÄ±f DaÄŸÄ±lÄ±mÄ±")
plt.show()

from sklearn.model_selection import train_test_split

# Ã–zellikleri (X) ve hedef deÄŸiÅŸkeni (y) ayÄ±r
X = df_encoded.drop('HeartDisease', axis=1)
y = df_encoded['HeartDisease']

# EÄŸitim ve test setlerini ayÄ±r (80% eÄŸitim, 20% test)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42, stratify=y)

from sklearn.linear_model import LogisticRegression
from sklearn.ensemble import RandomForestClassifier
from xgboost import XGBClassifier
from sklearn.metrics import classification_report, confusion_matrix, roc_auc_score, RocCurveDisplay

# Modelleri tanÄ±mla
models = {
    "Logistic Regression": LogisticRegression(max_iter=1000),
    "Random Forest": RandomForestClassifier(n_estimators=100, random_state=42),
    "XGBoost": XGBClassifier(use_label_encoder=False, eval_metric='logloss', random_state=42)
}

# EÄŸitim ve deÄŸerlendirme
for name, model in models.items():
    print(f"\nğŸ” Model: {name}")
    model.fit(X_train, y_train)
    y_pred = model.predict(X_test)
    print(classification_report(y_test, y_pred))
    print("ROC AUC:", roc_auc_score(y_test, y_pred))

    # ROC eÄŸrisi
    RocCurveDisplay.from_estimator(model, X_test, y_test)
    plt.title(f"ROC Curve - {name}")
    plt.show()

importances = models["XGBoost"].feature_importances_
features = X.columns
importance_df = pd.DataFrame({"Feature": features, "Importance": importances})
importance_df.sort_values("Importance", ascending=False, inplace=True)

# GÃ¶rselleÅŸtirme
plt.figure(figsize=(10, 6))
sns.barplot(x="Importance", y="Feature", data=importance_df)
plt.title("XGBoost Feature Importance")
plt.show()